{% extends 'baseLogged.html.twig' %}

{% block stylesheets %}
    {{parent()}}
{% endblock %}

{% block breadcrumb %}
    {% include 'breadcrumb.html.twig' with {'modulos': data.modulo} %}
{% endblock %}

{% block principal %}

    <form action="{% if data.permissao.permissao > 1 %} /{{data.modulo.url}} {% else %} javascript:void(0); {% endif %}" method="post" role="form" class="form-usuario">


        <div class="card card-outline-info" style="margin-bottom:10px;">
            <div class="card-header">
                <h4 class="m-b-0 text-white">Lista de Preço por Categoria</h4>
            </div>
            <div class="card-body">

                <input type="hidden" name="voltar" value="{{data.voltar}}">

                {% if data.registro.id is defined %}
                    <input type="hidden" name="id" value="{{data.registro.id}}">
                    <input type="hidden" name="_METHOD" value="PUT"/>
                {% endif %}

                <div class="row">
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label>Código*</label>
                            <input type="text"
                                name="cod_lista"
                                class="form-control"
                                placeholder="Informe o Código da Lista"
                                value="{% if data.registro.cod_lista is defined %}{{data.registro.cod_lista}}{% endif %}"
                                required
                                maxlength="10"
                                autofocus />
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="form-group">
                            <label>Descrição*</label>
                            <input type="text"
                                name="descricao"
                                class="form-control"
                                placeholder="Informe a Descrição"
                                value="{% if data.registro.descricao is defined %}{{data.registro.descricao}}{% endif %}"
                                required
                                maxlength="70"
                                autofocus />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Status*</label>
                            <select name="sit" class="form-control" required>
                                <option value="1" {% if data.registro.sit is defined and data.registro.sit == '1' %} selected="selected" {% endif %}>Ativo</option>
                                <option value="0" {% if data.registro.sit is defined and data.registro.sit == '0' %} selected="selected" {% endif %}>Inativo</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card card-outline-info">
            <div class="card-body">
                <div class="col-lg-12">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="70%">Categoria</th>
                                <th width="20%">Valor</th>
                                <th width="10%"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for index, servico in data.registro.ValorCategoriaPrecos %}
                                <tr data-index="{{index}}">
                                    <td>
                                        <select name="precos[{{index}}][categoria_id]" class="form-control" required>
                                            <option value="">Selecione uma Categoria</option>
                                            {% for categoria in data.categorias %}
                                                {%
                                                    set categoriaSelected = servico.categoria_id == categoria.id
                                                        ? 'selected="selected"'
                                                        : ''
                                                %}
                                                <option value="{{categoria.id}}" {{categoriaSelected}}>
                                                   {{categoria.cod_cat}} - {{categoria.descricao}}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text"
                                               name="precos[{{index}}][preco]"
                                               class="form-control preco"
                                               data-affixes-stay="true"
                                               data-prefix="R$ "
                                               data-thousands="."
                                               data-decimal=","
                                               value="{{servico.preco|number_format('2',',','.')}}"
                                               required />
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);"
                                           class="btn btn-xs btn-danger btn-remover-linha align-self-center p-2">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                            {% else %}
                                <tr data-index="0">
                                    <td>
                                        <select name="precos[0][categoria_id]" class="form-control" required>
                                            <option value="">Selecione uma Categoria</option>
                                            {% for categoria in data.categorias %}
                                                <option value="{{categoria.id}}" {{categoriaSelected}}>
                                                   {{categoria.cod_cat}} - {{categoria.descricao}}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text"
                                            name="precos[0][preco]"
                                            class="form-control preco"
                                            data-affixes-stay="true"
                                            data-prefix="R$ "
                                            data-thousands="."
                                            data-decimal=","
                                            value=""
                                            required />
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);"
                                            class="btn btn-xs btn-danger btn-remover-linha align-self-center p-2">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-right">
                                    <a href="javascript:void(0);" class="btn btn-success btn-adicionar-linha align-self-center p-2"><i class="fa fa-plus"></i> Adicionar </a>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>


        <div class="card card-body" style="margin-top: -20px;">
            <div class="row">
                <div class="col-lg-12">
                    {% if data.permissao.permissao > 1 %}
                        <button type="submit" class="btn btn-success btn-submit" data-loading-text="Aguarde...">
                            <i class="fa fa-check"></i>{% if data.registro.id is defined %} Editar {% else %} Adicionar {% endif %}
                        </button>
                    {% endif %}
                    <a href="{{data.voltar}}" class="btn btn-inverse waves-effect waves-light">
                        <i class="fa fa-times"></i> Cancelar
                    </a>
                </div>
            </div>
        </div>

    </form>

{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script id="novoPrecoPorCategoria" type="text/template">
        <tr data-index="@index">
            <td>
                <select name="precos[@index][categoria_id]" class="form-control">
                    <option value="">Selecione uma Categoria</option>
                    {% for categoria in data.categorias %}
                        <option value="{{categoria.id}}" {{categoriaSelected}}>
                          {{categoria.cod_cat}} - {{categoria.descricao}}
                        </option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <input type="text"
                       name="precos[@index][preco]"
                       class="form-control preco"
                       data-affixes-stay="true"
                       data-prefix="R$ "
                       data-thousands="."
                       data-decimal=","
                       value="" />
            </td>
            <td>
                <a href="javascript:void(0);"
                    class="btn btn-xs btn-danger btn-remover-linha align-self-center p-2">
                    <i class="fa fa-trash"></i>
                </a>
            </td>
        </tr>
    </script>
{% endblock %}
